æ–‡ç« æ¥æºï¼š
https://blog.csdn.net/Sheng_Q/article/details/128277653?spm=1001.2014.3001.5501
https://www.cnblogs.com/johnnyzen/p/17419972.html#_label3_2_1_1



æœ¬ç¯‡æ‰€ä½¿ç”¨çš„æµ‹è¯•ç±»å¦‚ä¸‹
é¡¹ç›®:rookie-spring-framework-web
æµ‹è¯•ç±»ï¼šcom.rookie.bigdata.springframework.context.messagesource.i18n.SpringResourceBundleTest#test01()

æœ¬ç¯‡æ‰€ä½¿ç”¨çš„æµ‹è¯•ç±»å¦‚ä¸‹
é¡¹ç›®:rookie-springboot-webmvc
æµ‹è¯•ç±»ï¼šcom.rookie.bigdata.springframework.context.messagesource.i18n.SpringBootResourceBundleTest#testI18n()


Springæä¾›çš„å›½é™…åŒ–æ¥å£ä¸ºï¼šMessageSource
ç»§æ‰¿å…³ç³»å¦‚å›¾ï¼š./pic/lifecycle/i18n/01_i18n.png
Springå…±æä¾›äº†å››ç§å®ç°ç±»ï¼šDelegatingMessageSource, StaticMessageSource, ResourceBundleMessageSource, ReloadableResourceBundleMessageSource.
å¸¸è§ä¸ºåä¸¤ç§: ResourceBundleMessageSourceä¾èµ–äºJDKæä¾›çš„APIï¼Œå³ä¾èµ–ResourceBundle.getBundle(basename, locale, classLoader, control)æ–¹æ³•å®ç°å›½é™…åŒ–ï¼›ReloadableResourceBundleMessageSourceæä¾›äº†å®šæ—¶æ›´æ–°å›½é™…åŒ–çš„èƒ½åŠ›è€Œæ— éœ€é‡å¯æœºå™¨; æœ¬æ–‡ä»¥ResourceBundleMessageSourceä¸ºä¾‹ä»‹ç»å¦‚ä½•åœ¨Springé¡¹ç›®ä¸­ä½¿ç”¨å›½é™…åŒ–(ReloadableResourceBundleMessageSourceä½¿ç”¨ä¸ä¹‹ç±»ä¼¼)

1   Springå›½é™…åŒ–åŸç†
    1.1 åœ¨å¯åŠ¨Springå®¹å™¨æ—¶â€”æ‰§è¡Œrefresh()çš„æ­¥éª¤ä¸­å­˜åœ¨initMessageSource()æ–¹æ³•
        1.1.1   å¦‚æœBeanFactoryä¸­å­˜åœ¨beanNameä¸º"messageSource"çš„BeanDefinitionï¼š å®ä¾‹åŒ–è¯¥BeanDefinitionå¹¶å°†Beanå¯¹è±¡è®¾ç½®ç»™AbstractApplicationContextçš„messageSourceå±æ€§ï¼›åŒæ—¶å¦‚æœè¯¥Springå®¹å™¨å­˜åœ¨çˆ¶å®¹å™¨ä¸”è¯¥å›½é™…åŒ–å¯¹è±¡ä¸ºHierarchicalMessageSourceç±»å‹(å…·å¤‡çˆ¶å­ç»“æ„), åˆ™ä¸€å¹¶è®¾ç½®å›½é™…åŒ–å¯¹è±¡çš„çˆ¶å­å…³ç³»
        1.1.2   ä¸å­˜åœ¨"messageSource"ï¼š å®ä¾‹åŒ–ä¸€ä¸ªDelegatingMessageSourceç±»å‹çš„å¯¹è±¡ï¼Œå¹¶æ³¨å†Œåˆ°IOCå®¹å™¨ä¸­ï¼ŒåŒæ—¶èµ‹å€¼ç»™AbstractApplicationContextçš„messageSourceå±æ€§ã€‚å¦‚æ³¨é‡Š// Use empty MessageSource to be able to accept getMessage calls ï¼šDelegatingMessageSourceæ— å®é™…åŠŸèƒ½ï¼Œæ˜¯ä¸ºäº†è®©è°ƒç”¨ä¸ä¼šæŠ›ç©ºæŒ‡é’ˆ
        Springå®¹å™¨åœ¨AbstractApplicationContextä¸­å¼•å…¥äº†messageSourceå±æ€§ï¼Œå¹¶åœ¨å¯åŠ¨å®¹å™¨çš„è¿‡ç¨‹ä¸­å°†"messageSource"å¯¹åº”çš„Beanå¯¹è±¡è®¾ç½®ç»™messageSourceå±æ€§ï¼›è¿™å°±æ˜ç¤ºç€è¦å°†å›½é™…åŒ–å¯¹è±¡ä½œä¸ºä¸€ä¸ªå®¹å™¨çº§åˆ«çš„å…¨å±€ç»„ä»¶å¯¹å¤–æä¾›ï¼Œå› æ­¤Springé¡¹ç›®ä¸­å¦‚æœè®¾ç½®äº†å›½é™…åŒ–å¯¹è±¡ï¼Œå¿…é¡»å°†beanNameè®¾ç½®ä¸º"messageSource".
    1.2 getMessageæ–¹æ³•
        1.2.1   å…ˆè°ƒç”¨getMessageInternal(code, args, locale)è·å–å›½é™…åŒ–ä¿¡æ¯ï¼Œä¸ä¸ºç©ºåˆ™ç›´æ¥è¿”å›ï¼›å¦åˆ™è¿›å…¥ä»æ”¯1ï¼Œè°ƒç”¨getDefaultMessage(code)é€»è¾‘ï¼Œå¦‚æœé…ç½®é¡¹useCodeAsDefaultMessageå±æ€§ä¸ºtrue(é»˜è®¤ä¸ºfalse)åˆ™å°†codeæœ¬èº«ä½œä¸ºå›½é™…åŒ–ä¿¡æ¯è¿”å›ï¼Œå¦åˆ™getDefaultMessage(code)å¾—åˆ°nullï¼›è¿›å…¥ä»æ”¯2â€”æŠ›å‡ºå¼‚å¸¸
        1.2.2   è·Ÿè¿›getMessageInternal(code, args, locale)æ–¹æ³•
            (1) ä¼˜å…ˆä»å›½é™…åŒ–èµ„æºä¸­è·å–ï¼Œè·å–å¤±è´¥æ—¶å†ä»é…ç½®é¡¹commonMessageså¯¹è±¡ä¸­è·å–â€”ğŸ¥¶â€”è·å–å¤±è´¥å†ä»å…¶çˆ¶å¯¹è±¡ä¸­è·å–ï¼›
            (2) ä»å›½é™…åŒ–èµ„æºä¸­è·å–æ—¶ï¼Œå¦‚æœéœ€è¦å¤„ç†å ä½ç¬¦åˆ™å…ˆå¤„ç†å ä½ç¬¦å†å¤„ç†å›½é™…åŒ–
            3) ä¸éœ€è¦å¤„ç†å ä½ç¬¦ï¼šç›´æ¥è°ƒç”¨resolveCodeWithoutArguments(code, locale)è·å–ï¼›è¿›å…¥resolveCodeWithoutArgumentså†…éƒ¨
        1.2.3    è·Ÿè¿›getResourceBundle(basename, locale)
            step2ä¸­çš„(2)å’Œ(3)æœ€ç»ˆéƒ½ä¼šè°ƒç”¨getResourceBundle(basename, locale)æ–¹æ³•è·å–ResourceBundleå¯¹è±¡ï¼Œç„¶åä»ResourceBundleå¯¹è±¡ä¸­è·å–å›½é™…åŒ–ä¿¡æ¯(æ ¹æ®codeä»ResourceBundleå¯¹è±¡çš„å±æ€§ä¸­è§£æï¼Œé€»è¾‘è¾ƒä¸ºç®€å•)ï¼›
            å‰©ä½™çš„è°ƒç”¨é“¾ä¾æ¬¡ä¸ºï¼šResourceBundle bundle = doGetBundle(basename, locale); -> ResourceBundle.getBundle(basename, locale, classLoader, control);, è€Œåè€…ä¸ºJDKæä¾›çš„APIã€‚



